{% extends "new/base.html" %}
{% load static %}
{% block content %}

<script>
    var admissionsData = JSON.parse('{{ admissions_data|escapejs }}');
    var selectedGender = "Gender-Neutral"; // Default value
    var catg = "OPEN"; // Default value
    var Year1 = "0";

    function changeCategory(category) {
        document.getElementById("categoryDropdown").innerText = category;
        catg = category;
    }

    function changeGender(gender) {
        document.getElementById("genderDropdown").innerText = gender;
        selectedGender = gender;
    }

    function changeyear(year) {
        document.getElementById("YearDropdown").innerText = year;
        Year1 = year;
    }

    function changefile() {
        let rank = document.querySelector("#rank").value;
        let tbody = document.querySelector("#filteredTable tbody");
        tbody.innerHTML = ""; // Clear old rows

        let found = false; // Flag to check if any college matches

        for (let i = 0; i < admissionsData.length; i++) {
            let adm = admissionsData[i].fields;
            let closingRank = adm.closing_rank;
            let openingRank = adm.opening_rank;
            let gender = adm.gender;
            let Year = adm.year;
            let category = adm.seat_type;

            if (rank <= closingRank && selectedGender === gender && catg === category && Year1 == Year) {
                let row = tbody.insertRow();
                row.insertCell(0).innerHTML = adm.institute;
                row.insertCell(1).innerHTML = adm.academic_program_name;
                row.insertCell(2).innerHTML = openingRank;
                row.insertCell(3).innerHTML = closingRank;
                row.insertCell(4).innerHTML = gender;
                row.insertCell(5).innerHTML = Year;
                row.insertCell(6).innerHTML = category;

                found = true; // Found at least one matching college
            }
        }

        // Show message if no colleges found
        if(Year1==0){
             let row = tbody.insertRow();
            let cell = row.insertCell(0);
            cell.colSpan = 7; // Span across all table columns
             cell.innerHTML = "Plz select year"; 
              cell.style.textAlign = "center";
            cell.style.color = "#ff0000";
            cell.style.fontWeight = "600";
        }
       else if (!found) {
            let row = tbody.insertRow();
            let cell = row.insertCell(0);
            cell.colSpan = 7; // Span across all table columns
            cell.innerHTML = "Sorry, there is no IIT Seat available at your rank in any branch for the selected year, category, and gender.";
            cell.style.textAlign = "center";
            cell.style.color = "#ff0000";
            cell.style.fontWeight = "600";
        }
    }
</script>

<style>
    /* Page container */
    .center-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 5px;
        margin-top: 3rem;
    }

    h4.alok1 {
        font-size: 26px;
        font-weight: 700;
        color: #182118;
        margin-bottom: 25px;
        text-align: center;
    }

    /* Inputs & dropdowns */
    .form-control-custom,
    .dropdown .btn,
    input[type="submit"] {
        width: 320px;
        padding: 12px 15px;
        font-size: 16px;
        text-align: center;
        border-radius: 8px;
        margin-top: 12px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        transition: all 0.3s ease;
    }

    .form-control-custom {
        border: 1px solid #ddd;
        background: #f5f5f5;
        color: #424242;
    }

    #rank {
        background-color: #c7d4c8;
    }

    #rank::placeholder {
        color: #181414;
        font-size: 15px;
    }

    .dropdown .btn {
        background-color: #c7d4c8;
        color: #181414;
        border: none;
        font-weight: 600;
    }

    .dropdown .btn:hover {
        background-color: #ebebed;
    }

    input[type="submit"] {
        background-color: #c7d4c8;
        color: #141212;
        font-weight: 600;
        border: none;
        cursor: pointer;
    }

    input[type="submit"]:hover {
        background-color: #388e3c;
        color: #fff;
    }

    /* Table */
    #filteredTable {
     margin-top: 40px;
    width: 95%;
    max-width: 1100px;
    text-align: center;
    border-radius: 10px;
    border-collapse: separate;   /* instead of collapse */
    border-spacing: 0;          /* removes gaps between cells */
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
   }
#filteredTable th:first-child {
    border-top-left-radius: 5px;
}

#filteredTable th:last-child {
    border-top-right-radius: 5px;
}

#filteredTable tr:last-child td:first-child {
    border-bottom-left-radius: 5px;
}

#filteredTable tr:last-child td:last-child {
    border-bottom-right-radius: 5px;
}

    #filteredTable th,
    #filteredTable td {
        padding: 14px 18px;
        border: 1px solid #141111;
    }

    #filteredTable th {
        background: #f3f2f4;
        color: #141313;
        font-weight: 800;
    }

    #filteredTable td {
        background: #fafafa;
        color:  #141313;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .form-control-custom,
        .dropdown .btn,
        input[type="submit"] {
            width: 80%;
        }

        #filteredTable {
            font-size: 14px;
        }

        #filteredTable th,
        #filteredTable td {
            padding: 10px;
        }
    }

    @media (max-width: 480px) {
        .form-control-custom,
        .dropdown .btn,
        input[type="submit"] {
            width: 95%;
            font-size: 14px;
            padding: 10px;
        }

        #filteredTable {
            font-size: 13px;
        }

        #filteredTable th,
        #filteredTable td {
            padding: 8px;
        }
    }
</style>

<div class="center-container">
    <h4 class="alok1">Show the list of colleges on my rank</h4>

    <!-- Rank input -->
    <input type="number" id="rank" name="rank" class="form-control-custom" placeholder="Rank">

    <!-- Category dropdown -->
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="categoryDropdown" data-toggle="dropdown">
            Category: OPEN
        </button>
        <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#" onclick="changeCategory('OPEN')">OPEN</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('EWS')">EWS</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('OBC-NCL')">OBC-NCL</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('SC')">SC</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('ST')">ST</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('OPEN (PwD)')">OPEN (PwD)</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('EWS (PwD)')">EWS (PwD)</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('OBC-NCL (PwD)')">OBC-NCL (PwD)</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('SC (PwD)')">SC (PwD)</a>
            <a class="dropdown-item" href="#" onclick="changeCategory('ST (PwD)')">ST (PwD)</a>
        </div>
    </div>

    <!-- Year dropdown -->
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="YearDropdown" data-toggle="dropdown">
            Year
        </button>
        <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#" onclick="changeyear('2016')">2016</a>
            <a class="dropdown-item" href="#" onclick="changeyear('2017')">2017</a>
            <a class="dropdown-item" href="#" onclick="changeyear('2018')">2018</a>
            <a class="dropdown-item" href="#" onclick="changeyear('2019')">2019</a>
            <a class="dropdown-item" href="#" onclick="changeyear('2020')">2020</a>
            <a class="dropdown-item" href="#" onclick="changeyear('2021')">2021</a>
            <a class="dropdown-item" href="#" onclick="changeyear('2022')">2022</a>
            <a class="dropdown-item" href="#" onclick="changeyear('2023')">2023</a>
        </div>
    </div>

    <!-- Gender dropdown -->
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="genderDropdown" data-toggle="dropdown">
            Gender-Neutral
        </button>
        <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#" onclick="changeGender('Gender-Neutral')">Gender-Neutral</a>
            <a class="dropdown-item" href="#" onclick="changeGender('Female-only (including Supernumerary)')">Female</a>
        </div>
    </div>

    <!-- Submit button -->
    <input type="submit" onclick="changefile()" value="Submit">

    <!-- Results table -->
    <table id="filteredTable">
        <thead>
            <tr>
                <th>Institute</th>
                <th>Academic Program Name</th>
                <th>Opening Rank</th>
                <th>Closing Rank</th>
                <th>Gender</th>
                <th>Year</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

{% endblock content %}
